{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
  {{block.super}}
    <style>
        /* Светлый скроллбар */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f4f7f6; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #bbb; }

        /* Фон всей страницы контента */
        #content {
            background-color: #f4f7f6 !important;
            min-height: 100vh;
        }

        /* Карточка компании (Tenant) */
        .tenant-card {
            background: #ffffff;
            border: 1px solid #e0e0e0 !important;
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        .tenant-card:hover {
            transform: translateY(-8px);
            border-color: #28a745 !important;
            box-shadow: 0 15px 30px rgba(0,0,0,0.08) !important;
        }

        /* Кнопка перехода */
        .action-btn {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            color: #555;
            font-weight: 700;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            transition: all 0.2s;
        }
        .action-btn:hover {
            background: #212529;
            color: #fff;
            border-color: #212529;
        }

        /* Анимации статуса для светлой темы */
        .status-dot-pulse {
            width: 10px; height: 10px;
            background: #28a745;
            border-radius: 50%;
            box-shadow: 0 0 0 rgba(40, 167, 69, 0.4);
            animation: pulse-green 2s infinite;
        }
        .status-dot-danger {
            width: 10px; height: 10px;
            background: #dc3545;
            border-radius: 50%;
            box-shadow: 0 0 0 rgba(220, 53, 69, 0.4);
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 8px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 8px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        /* Мини-строка филиала */
        .branch-item {
            background: #fcfdfd;
            border: 1px solid #f0f0f0;
            transition: background 0.2s;
        }
        .branch-item:hover {
            background: #f8f9fa;
        }
    </style>
{% endblock %}

{% block content %}
<div class="container-fluid p-4" style="font-family: 'Inter', sans-serif;">
    
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-5 gap-3">
        <div>
            <h1 class="h3 fw-bold mb-1" style="color: #212529;">Инфраструктура</h1>
            <p class="text-muted small mb-0">Управление активными клиентами и их филиалами</p>
        </div>
        <div class="d-flex gap-2">
            <a href="/admin/company/company/add/" class="btn btn-success btn-sm px-4 fw-bold shadow-sm" style="border-radius: 8px; background-color: #28a745;">
                + Новый Клиент
            </a>
        </div>
    </div>

    <div class="row g-4">
        {% for item in tenants %}
        <div class="col-md-6 col-xl-4">
            <div class="card h-100 tenant-card shadow-sm">
                
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start mb-4">
                        <div>
                            <div class="d-flex align-items-center gap-3 mb-2">
                                {% if item.tenant.is_active %}
                                    <div class="status-dot-pulse" title="Active"></div>
                                {% else %}
                                    <div class="status-dot-danger" title="Inactive"></div>
                                {% endif %}
                                
                                <h5 class="fw-bold mb-0" style="letter-spacing: -0.5px; color: #212529;">
                                    {{ item.tenant.name|upper }}
                                </h5>
                            </div>
                            <span class="badge bg-light text-dark border font-monospace" style="font-size: 0.75rem; padding: 5px 10px;">
                                {{ item.domain }}
                            </span>
                        </div>
                        <div class="text-end">
                            <div class="small text-muted text-uppercase fw-bold" style="font-size: 0.6rem; letter-spacing: 1px;">Рестораны</div>
                            <div class="h4 fw-bold mb-0" style="color: #28a745;">{{ item.branch_count }}</div>
                        </div>
                    </div>

                    <div class="mb-2">
                        {% for branch in item.branches %}
                        <div class="d-flex align-items-center justify-content-between p-2 mb-2 rounded-3 branch-item">
                            <div class="d-flex align-items-center">
                                <div class="bg-success rounded-circle me-3" style="width: 5px; height: 5px; opacity: 0.4;"></div>
                                <span class="text-dark small fw-medium">{{ branch.name }}</span>
                            </div>
                            {% if item.tenant.is_active %}
                                <span class="badge bg-success-subtle text-success border-0" style="font-size: 0.65rem;">ONLINE</span>
                            {% endif %}
                        </div>
                        {% empty %}
                        <div class="text-center py-4 border border-dashed rounded-3" style="border-color: #ddd !important;">
                            <span class="text-muted small fst-italic">Конфигурация отсутствует</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="card-footer bg-light border-0 p-3">
                    <a href="https://{{item.domain}}/admin" target="_blank" class="btn btn-sm w-100 action-btn py-2 shadow-sm rounded-3">
                        ПЕРЕЙТИ В УПРАВЛЕНИЕ
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}